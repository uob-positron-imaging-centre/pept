<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.6.3" />
<title>pept.scanners.modular_camera API documentation</title>
<meta name="description" content="" />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase;cursor:pointer}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>pept.scanners.modular_camera</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>Source code</summary>
<pre><code class="python">#!/usr/bin/env python3
# -*- coding: utf-8 -*-


# File   : __init__.py
# License: License: GNU v3.0
# Author : Sam Manger &lt;s.manger@bham.ac.uk&gt;
# Date   : 20.08.2019


from    .modular_camera    import  ModularCamera


__all__ = [
    &#39;ModularCamera&#39;
]


__author__ =        &#34;Sam Manger&#34;
__credits__ =       [&#34;Andrei Leonard Nicusan&#34;, &#34;Kit Windows-Yule&#34;, &#34;Sam Manger&#34;]
__license__ =       &#34;GNU v3.0&#34;
__version__ =       &#34;0.1.0&#34;
__maintainer__ =    &#34;Sam Manger&#34;
__email__ =         &#34;s.manger@bham.ac.uk&#34;
__status__ =        &#34;Development&#34;</code></pre>
</details>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="pept.scanners.modular_camera.extensions" href="extensions/index.html">pept.scanners.modular_camera.extensions</a></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt><code class="name"><a title="pept.scanners.modular_camera.modular_camera" href="modular_camera.html">pept.scanners.modular_camera.modular_camera</a></code></dt>
<dd>
<section class="desc"></section>
</dd>
</dl>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="pept.scanners.modular_camera.ModularCamera"><code class="flex name class">
<span>class <span class="ident">ModularCamera</span></span>
<span>(</span><span>dataFile, sample_size=200, overlap=0, filtered=[], verbose=True)</span>
</code></dt>
<dd>
<section class="desc"><p>A subclass of <code>LineData</code> that reads PEPT data from the modular camera DAQ.</p>
<p>Provides the same functionality as the <code>LineData</code> class while
initialising <code>line_data</code> from a given file. This is a helper class
for <strong>PEPT using the modular camera</strong>.</p>
<p>Can read data from a <code>.da_1</code> file or equivalent. The file must contain
the standard datawords from the modular camera output. This will then
be automatically transformed into the standard <code>_line_data</code> format
with every row being <code>[time, x1, y1, z1, x2, y2, z2]</code>, where the geometry
is derived from the C-extension. The current useable geometry is a square
layout with 4 stacks for 4 modules, separated by 250 mm.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>dataFile</code></strong> :&ensp;<code>str</code></dt>
<dd>A string with the (absolute or relative) path to the data file
from which the PEPT data will be read. It should include the
full file name, along with the extension (.da_1)</dd>
<dt><strong><code>sample_size</code></strong> :&ensp;<code>int</code>, optional</dt>
<dd>An <code>int`` that defines the number of lines that should be
returned when iterating over</code>_line_data<code>. A</code>sample_size` of 0
yields all the data as one single sample. (Default is 200)</dd>
<dt><strong><code>overlap</code></strong> :&ensp;<code>int</code>, optional</dt>
<dd>An <code>int</code> that defines the overlap between two consecutive
samples that are returned when iterating over <code>_line_data</code>.
An overlap of 0 means consecutive samples, while an overlap
of (<code>sample_size</code> - 1) means incrementing the samples by one.
A negative overlap means skipping values between samples. An
error is raised if <code>overlap</code> is larger than or equal to
<code>sample_size</code>. (Default is 0)</dd>
<dt><strong><code>filtered</code></strong> :&ensp;<code>list</code>, optional</dt>
<dd>A list of 'int's of module pair numbers that will be filtered
from the PEPT data. For use when noisy data affects tracking.
(Default is [])</dd>
<dt><strong><code>verbose</code></strong> :&ensp;<code>bool</code>, optional</dt>
<dd>An option that enables printing the time taken for the
initialisation of an instance of the class. Useful when
reading large files (10gb files for PEPT data is not unheard
of). (Default is True)</dd>
</dl>
<h2 id="attributes">Attributes</h2>
<dl>
<dt><strong><code>_line_data</code></strong> :&ensp;(<code>N</code>, <code>7</code>) <code>numpy.ndarray</code></dt>
<dd>An (N, 7) numpy array that stores the PEPT LoRs as time and
cartesian (3D) coordinates of two points defining a line, <strong>in mm</strong>.
Each row is then <code>[time, x1, y1, z1, x2, y2, z2]</code>.</dd>
<dt><strong><code>sample_size</code></strong> :&ensp;<code>int</code></dt>
<dd>An <code>int</code> that defines the number of lines that should be
returned when iterating over <code>_line_data</code>. (Default is 200)</dd>
<dt><strong><code>overlap</code></strong> :&ensp;<code>int</code></dt>
<dd>An <code>int</code> that defines the overlap between two consecutive
samples that are returned when iterating over <code>_line_data</code>.
An overlap of 0 means consecutive samples, while an overlap
of (<code>sample_size</code> - 1) means incrementing the samples by one.
A negative overlap means skipping values between samples. It
has to be smaller than <code>sample_size</code>. (Default is 0)</dd>
<dt><strong><code>numberOfLines</code></strong> :&ensp;<code>int</code></dt>
<dd>An <code>int</code> that corresponds to len(<code>_line_data</code>), or the number of
LoRs stored by <code>_line_data</code>.</dd>
</dl>
<h2 id="raises">Raises</h2>
<dl>
<dt><code>ValueError</code></dt>
<dd>If <code>overlap</code> &gt;= <code>sample_size</code>. Overlap has to be smaller than
<code>sample_size</code>. Note that it can also be negative.</dd>
<dt><code>ValueError</code></dt>
<dd>If the data file does not have (N, 7) shape.</dd>
</dl>
<h2 id="notes">Notes</h2>
<p>The class saves <code>line_data</code> as a <strong>contiguous</strong> numpy array for
efficient access in C functions. It should not be changed after
instantiating the class.</p></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">class ModularCamera(LineData):
        &#39;&#39;&#39;A subclass of `LineData` that reads PEPT data from the modular camera DAQ.

        Provides the same functionality as the `LineData` class while
        initialising `line_data` from a given file. This is a helper class
        for **PEPT using the modular camera**.

        Can read data from a `.da_1` file or equivalent. The file must contain
        the standard datawords from the modular camera output. This will then
        be automatically transformed into the standard `_line_data` format
        with every row being `[time, x1, y1, z1, x2, y2, z2]`, where the geometry
        is derived from the C-extension. The current useable geometry is a square
        layout with 4 stacks for 4 modules, separated by 250 mm.

        Parameters
        ----------
        dataFile : str
                A string with the (absolute or relative) path to the data file
                from which the PEPT data will be read. It should include the
                full file name, along with the extension (.da_1)
        sample_size : int, optional
                An `int`` that defines the number of lines that should be
                returned when iterating over `_line_data`. A `sample_size` of 0
                yields all the data as one single sample. (Default is 200)
        overlap : int, optional
                An `int` that defines the overlap between two consecutive
                samples that are returned when iterating over `_line_data`.
                An overlap of 0 means consecutive samples, while an overlap
                of (`sample_size` - 1) means incrementing the samples by one.
                A negative overlap means skipping values between samples. An
                error is raised if `overlap` is larger than or equal to
                `sample_size`. (Default is 0)
        filtered : list, optional
                A list of &#39;int&#39;s of module pair numbers that will be filtered
                from the PEPT data. For use when noisy data affects tracking.
                (Default is [])
        verbose : bool, optional
                An option that enables printing the time taken for the
                initialisation of an instance of the class. Useful when
                reading large files (10gb files for PEPT data is not unheard
                of). (Default is True)

        Attributes
        ----------
        _line_data : (N, 7) numpy.ndarray
                An (N, 7) numpy array that stores the PEPT LoRs as time and
                cartesian (3D) coordinates of two points defining a line, **in mm**.
                Each row is then `[time, x1, y1, z1, x2, y2, z2]`.
        sample_size : int
                An `int` that defines the number of lines that should be
                returned when iterating over `_line_data`. (Default is 200)
        overlap : int
                An `int` that defines the overlap between two consecutive
                samples that are returned when iterating over `_line_data`.
                An overlap of 0 means consecutive samples, while an overlap
                of (`sample_size` - 1) means incrementing the samples by one.
                A negative overlap means skipping values between samples. It
                has to be smaller than `sample_size`. (Default is 0)
        numberOfLines : int
                An `int` that corresponds to len(`_line_data`), or the number of
                LoRs stored by `_line_data`.

        Raises
        ------
        ValueError
                If `overlap` &gt;= `sample_size`. Overlap has to be smaller than
                `sample_size`. Note that it can also be negative.
        ValueError
                If the data file does not have (N, 7) shape.

        Notes
        -----
        The class saves `line_data` as a **contiguous** numpy array for
        efficient access in C functions. It should not be changed after
        instantiating the class.

        &#39;&#39;&#39;

        def __init__(self,
                                 dataFile,
                                 sample_size = 200,
                                 overlap = 0,
                                 filtered =[],
                                 verbose = True):

                if verbose:
                        start = time.time()

                if sample_size != 0 and overlap &gt;= sample_size:
                        raise ValueError(&#39;\n[ERROR]: overlap = {} must be smaller than sample_size = {}\n&#39;.format(overlap, sample_size))

                self._index = 0
                self._sample_size = sample_size
                self._overlap = overlap

                self.dataFile = dataFile
                self.filtered = []

                x = 10

                header_buffer_size = 1000

                self.n_events = 0

                if sample_size == 0:
                        sample_size = int( (os.path.getsize(self.dataFile) - header_buffer_size) /4 ) # Set the sample size to the expected number of events
                        self.overlap = -1


                # Modular camera data reader requires &#39;itag&#39; for timing. We will drop this column at the end of initialisation
                # Row: [itag, itime, X1, Y1, Z1, X2, Y2, Z2]

                self._line_data = np.zeros([sample_size, 8])

                with open(self.dataFile,&#34;rb&#34;) as f:

                        # Skip over the header and handshake word

                        f.seek(header_buffer_size)

                        word = f.read(4)

                        if word.hex() == &#39;cefacefa&#39;:
                                # Skip two words
                                word = f.read(4)
                                word = f.read(4)

                        itime = 0
                        itag = 0

                        BufTime = 0
                        nBuf = 0

                        while word != b&#39;&#39; and (self.n_events &lt; sample_size):

                                word = f.read(4)

                                if word.hex() == &#39;cefacefa&#39;: # Handshake word
                                        # Skip two words
                                        word = f.read(4)
                                        word = f.read(4)

                                if word!=b&#39;&#39;:
                                        word = int.from_bytes(word, &#34;little&#34;)

                                        self._line_data[self.n_events,:] = get_pept_LOR(word,itag,itime) # C function

                                        itag  = self._line_data[self.n_events,1]
                                        itime = self._line_data[self.n_events,1]

                                        self.n_events = self.n_events + 1

                                        if (self.n_events % x) == 0:
                                                print(&#34;Got &#34;, self.n_events,&#34;\n&#34;)
                                                x = x * 10

                # Remove &#39;zero&#39; lines
                self._line_data = self._line_data[np.all(self._line_data,axis=1)]

                # Drop itag column
                self._line_data = np.delete(self._line_data, 0, axis=1)

                self._number_of_lines = len(self._line_data)

                if verbose:
                        end = time.time()
                        print(&#34;Initialising the PEPT data took {} seconds\n&#34;.format(end - start))</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="pept.base.line_data.LineData" href="../../base/line_data.html#pept.base.line_data.LineData">LineData</a></li>
</ul>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="pept.base.line_data.LineData" href="../../base/line_data.html#pept.base.line_data.LineData">LineData</a></b></code>:
<ul class="hlist">
<li><code><a title="pept.base.line_data.LineData.line_data" href="../../base/line_data.html#pept.base.line_data.LineData.line_data">line_data</a></code></li>
<li><code><a title="pept.base.line_data.LineData.lines_trace" href="../../base/line_data.html#pept.base.line_data.LineData.lines_trace">lines_trace</a></code></li>
<li><code><a title="pept.base.line_data.LineData.number_of_lines" href="../../base/line_data.html#pept.base.line_data.LineData.number_of_lines">number_of_lines</a></code></li>
<li><code><a title="pept.base.line_data.LineData.number_of_samples" href="../../base/line_data.html#pept.base.line_data.LineData.number_of_samples">number_of_samples</a></code></li>
<li><code><a title="pept.base.line_data.LineData.overlap" href="../../base/line_data.html#pept.base.line_data.LineData.overlap">overlap</a></code></li>
<li><code><a title="pept.base.line_data.LineData.plot_all_lines" href="../../base/line_data.html#pept.base.line_data.LineData.plot_all_lines">plot_all_lines</a></code></li>
<li><code><a title="pept.base.line_data.LineData.plot_all_lines_alt_axes" href="../../base/line_data.html#pept.base.line_data.LineData.plot_all_lines_alt_axes">plot_all_lines_alt_axes</a></code></li>
<li><code><a title="pept.base.line_data.LineData.plot_lines_sample_n" href="../../base/line_data.html#pept.base.line_data.LineData.plot_lines_sample_n">plot_lines_sample_n</a></code></li>
<li><code><a title="pept.base.line_data.LineData.plot_lines_sample_n_alt_axes" href="../../base/line_data.html#pept.base.line_data.LineData.plot_lines_sample_n_alt_axes">plot_lines_sample_n_alt_axes</a></code></li>
<li><code><a title="pept.base.line_data.LineData.sample_n" href="../../base/line_data.html#pept.base.line_data.LineData.sample_n">sample_n</a></code></li>
<li><code><a title="pept.base.line_data.LineData.sample_size" href="../../base/line_data.html#pept.base.line_data.LineData.sample_size">sample_size</a></code></li>
<li><code><a title="pept.base.line_data.LineData.to_csv" href="../../base/line_data.html#pept.base.line_data.LineData.to_csv">to_csv</a></code></li>
</ul>
</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="pept.scanners" href="../index.html">pept.scanners</a></code></li>
</ul>
</li>
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="pept.scanners.modular_camera.extensions" href="extensions/index.html">pept.scanners.modular_camera.extensions</a></code></li>
<li><code><a title="pept.scanners.modular_camera.modular_camera" href="modular_camera.html">pept.scanners.modular_camera.modular_camera</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="pept.scanners.modular_camera.ModularCamera" href="#pept.scanners.modular_camera.ModularCamera">ModularCamera</a></code></h4>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.6.3</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>